<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="andy_paid_registrations" modification_key="fh_add_Razorpay_js_file" description="Add Razorpay checkout js file on Paid Registrations Template" execution_order="10" enabled="0" action="str_replace">
    <find><![CDATA[<xf:css src="andy_paid_registrations.less" />]]></find>
    <replace><![CDATA[$0
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>]]></replace>
  </modification>
  <modification type="public" template="andy_paid_registrations" modification_key="fh_add_razorpay_button" description="Add 'JOIN NOW' buttons with condition base on Paid Registrations Template" execution_order="10" enabled="0" action="str_replace">
    <find><![CDATA[<xf:button 
							   href="{{ $result.andy_paid_registrations_stripe }}"
							   class="button--link"
							   target="_blank"
							   >{{ phrase('paidregistrations_join_now') }}</xf:button>]]></find>
    <replace><![CDATA[<xf:if is="$result.andy_paid_registrations_stripe">
	<xf:button 
			   href="{{ $result.andy_paid_registrations_stripe }}"
			   class="button--link"
			   target="_blank"
			   >{{ phrase('paidregistrations_join_now') }}</xf:button>

</xf:if>




<xf:if is="$result.fh_paid_registrations_razorpay">

	<xf:button class="button--link" id="rzp-button-{$i}">{{ phrase('fh_join_now_with_razorpay') }}</xf:button>

	<script>					
		document.getElementById('rzp-button-{$i}').onclick = function(e){

			XF.ajax('GET', XF.canonicalizeUrl('index.php?paidregistrations/create-order'), {userUpgradeId: {$result.user_upgrade_id}}, function (res) {
				var razorpayOptions =	res.razorpayOptions;

				var rzp1 = new Razorpay(razorpayOptions);
				rzp1.open();
			});


			e.preventDefault();
		}
	</script>

</xf:if>]]></replace>
  </modification>
  <modification type="admin" template="user_upgrade_edit" modification_key="fh_add_razorpay_checkBox" description="Add razorpay checkBox if razorpay-KeyId and razorpay-KeySecret both are set in Options" execution_order="11" enabled="1" action="str_replace">
    <find><![CDATA[			<xf:checkboxrow>
				<xf:option name="can_purchase" selected="$upgrade.can_purchase">{{ phrase('can_be_purchased') }}</xf:option>
			</xf:checkboxrow>]]></find>
    <replace><![CDATA[	$0	
<xf:if is="$xf.options.fh_razorpayKeyId && $xf.options.fh_razorpayKeySecret">
	<xf:checkboxrow explain="{{ phrase('fh_paid_registrations_razorpay_explain') }}">
		<xf:option name="fh_paid_registrations_razorpay" selected="$upgrade.fh_paid_registrations_razorpay">{{ phrase('fh_paid_registrations_with_razorpay') }}</xf:option>
	</xf:checkboxrow>
</xf:if>]]></replace>
  </modification>
</template_modifications>
