<xf:macro name="custom_fields_edit"
		  arg-type="!"
		  arg-group="{{ null }}"
		  arg-set="!"
		  arg-editMode="user"
		  arg-onlyInclude="{{ null }}"
		  arg-additionalFilters="{{ [] }}"
		  arg-rowType=""
		  arg-options="!"
		  arg-rowClass=""
		  arg-namePrefix="custom_fields"
		  arg-requiredOnly="{{ false }}">

	<xf:foreach loop="$xf.app.getCustomFieldsForEdit({$type}, {$set}, {$editMode}, {$group}, {$onlyInclude}, {$additionalFilters})" key="$fieldId" value="$fieldDefinition">
		<xf:formrow label="{$fieldDefinition.title}"
					explain="{$fieldDefinition.description}"
					rowtype="{$rowType} customField {{ in_array($fieldDefinition.field_type, ['textbox', 'textarea', 'bbcode', 'select']) ? 'input' : '' }}"
					rowclass="{$rowClass}"
					data-field="{$fieldDefinition.field_id}">
			<xf:macro name="custom_fields_edit_{$fieldDefinition.field_type}" arg-set="{$set}" arg-options="{$options}" arg-definition="{$fieldDefinition}" arg-editMode="{$editMode}" arg-namePrefix="{$namePrefix}" />
		</xf:formrow>
	</xf:foreach>
</xf:macro>

<xf:macro name="custom_fields_edit_groups"
		  arg-type="!"
		  arg-groups="!"
		  arg-set="!"
		  arg-editMode="user"
		  arg-onlyInclude="{{ null }}"
		  arg-additionalFilters="{{ [] }}"
		  arg-rowType=""
		  arg-options="!"
		  arg-namePrefix="custom_fields"
		  arg-requiredOnly="">

	<xf:foreach loop="$groups" value="$group">
		<xf:macro name="custom_fields_edit"
				  arg-type="{$type}"
				  arg-group="{$group}"
				  arg-options="{$options}"
				  arg-set="{$set}"
				  arg-editMode="{$editMode}"
				  arg-onlyInclude="{$onlyInclude}"
				  arg-additionalFilters="{$additionalFilters}"
				  arg-rowType="{$rowType}"
				  arg-namePrefix="{$namePrefix}"
				  arg-requiredOnly="{$requiredOnly}" />
	</xf:foreach>
</xf:macro>

<xf:macro name="custom_fields_edit_textbox" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-namePrefix="custom_fields">

	<xf:if is="$definition.match_type == 'date'">

		<xf:dateinput name="options[{$definition.field_id}]" value="{{ $options.{$definition.field_id} ?: '' }}"
					  data-field="{$definition.field_id}"
					  maxlength="{{ $definition.max_length ? $definition.max_length : '' }}"
					  class="field_{$definition.field_id}" />

		<xf:elseif is="$definition.match_type == 'color'" />

		<xf:macro template="color_picker_macros" name="color_picker"
				  arg-name="options[{$definition.field_id}]"
				  arg-value="{{ $options.{$definition.field_id} ?: '' }}"
				  arg-mapName=""
				  arg-row="{{ false }}"
				  arg-options="{$options}"
				  arg-required="{$definition.isRequired($editMode)}" />

		<xf:elseif is="$definition.match_type == 'number'" />

		<xf:set var="$step" value="1" />

		<xf:if is="$definition.match_params.number_integer">
			<xf:if is="$definition.match_params.number_min >= 0">
				<xf:set var="$pattern" value="\d*" />
			</xf:if>
			<xf:else />
			<xf:set var="$step" value="any" />
		</xf:if>
		<xf:if is="$definition.match_params.number_min !== ''">
			<xf:set var="$min" value="{$definition.match_params.number_min}" />
		</xf:if>
		<xf:if is="$definition.match_params.number_max !== ''">
			<xf:set var="$max" value="{$definition.match_params.number_max}" />
		</xf:if>

		<xf:numberbox name="options[{$definition.field_id}]" value="{{ $options.{$definition.field_id} ?: '' }}"
					  maxlength="{{ $definition.max_length ? $definition.max_length : '' }}"
					  pattern="{$pattern}"
					  default=""
					  min="0"
					  max="{$max}"
					  step="{$step}"
					  class="field_{$definition.field_id}" />

		<xf:else />

		<xf:if is="in_array($definition.match_type, ['regex', 'alphanumeric'])">

			<xf:set var="$type" value="text" />
			<xf:set var="$pattern" value="{{ $definition.match_type == 'regex' ? $definition.match_params.regex : '\w+' }}" />
			<xf:set var="$title">{{ phrase('please_enter_value_that_matches_required_format') }}</xf:set>

			<xf:elseif is="in_array($definition.match_type, ['date', 'email', 'url', 'color'])" />

			<xf:set var="$type" value="{$definition.match_type}" />

			<xf:else />

			<xf:set var="$type" value="text" />

		</xf:if>

		<xf:textbox name="options[{$definition.field_id}]" value="{{ $options.{$definition.field_id} ?: '' }}"
					type="{$type}"
					maxlength="{{ $definition.max_length ? $definition.max_length : '' }}"
					pattern="{$pattern}"
					title="{$title}"
					min="0"
					max="{$max}"
					step="{$step}"
					class="field_{$definition.field_id}" />
	</xf:if>
</xf:macro>

<xf:macro name="custom_fields_edit_textarea" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-namePrefix="custom_fields">

	<xf:textarea name="options[{$definition.field_id}]" value="{{ $options.{$definition.field_id} ?: '' }}"
				 maxlength="{{ $definition.max_length ? $definition.max_length : '' }}"
				 autosize="true"
				 class="field_{$definition.field_id}" />
</xf:macro>

<xf:macro name="custom_fields_edit_bbcode" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-namePrefix="custom_fields">

	<xf:editor name="options[{$definition.field_id}]" value="{{ $options.{$definition.field_id} ?: '' }}"
			   previewable="0"
			   data-min-height="80"
			   data-attachment-target="false"
			   class="field_{$definition.field_id}" />
</xf:macro>

<xf:macro name="custom_fields_edit_select" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-multi="" arg-namePrefix="custom_fields">
	<xf:select name="options[{$definition.field_id}]"
			   value="{{ $options.{$definition.field_id} === null ? '' : {$options.{$definition.field_id}} }}"
			   multiple="{$multi}"
			   class="field_{$definition.field_id}">
		<xf:option value="" />
		<xf:options source="$definition.field_choices" />
	</xf:select>
</xf:macro>

<xf:macro name="custom_fields_edit_radio" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-namePrefix="custom_fields">

	<xf:radio name="options[{$definition.field_id}]"
			  value="{{ $options.{$definition.field_id} === null ? '' : {$options.{$definition.field_id}} }}"
			  class="field_{$definition.field_id}"
			  listclass="listColumns">
		<xf:if is="!$definition.isRequired($editMode)">
			<xf:option value="">{{ phrase('no_selection') }}</xf:option>
		</xf:if>
		<xf:foreach loop="$definition.field_choices" key="$value" value="$label">
			<xf:option value="{$value}">{$label}</xf:option>
		</xf:foreach>
	</xf:radio>
</xf:macro>

<xf:macro name="custom_fields_edit_checkbox" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-namePrefix="custom_fields">

	<xf:checkbox name="options[{$definition.field_id}]" value="{{ $options.{$definition.field_id} ?: '' }}"
				 listclass="field_{$definition.field_id} listColumns">
		<xf:options source="$definition.field_choices" />
	</xf:checkbox>
</xf:macro>

<xf:macro name="custom_fields_edit_multiselect" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-namePrefix="custom_fields">

	<xf:macro name="custom_fields_edit_select"
			  arg-set="{$set}"
			  arg-definition="{$definition}"
			  arg-options="{$options}"
			  arg-editMode="!"
			  arg-multi="1"
			  arg-namePrefix="{$namePrefix}" />
</xf:macro>

<xf:macro name="custom_fields_edit_stars" arg-options="!" arg-set="!" arg-definition="!" arg-editMode="!" arg-namePrefix="custom_fields">

	<xf:macro template="rating_macros" name="rating"
			  arg-name="options[{$definition.field_id}]"
			  arg-currentRating="{$set.{$definition.field_id}}"
			  arg-options="{$options}"
			  arg-deselectable="{{ $definition.isRequired($editMode) ? 'false' : 'true' }}"
			  arg-row="{{ false }}" />
</xf:macro>