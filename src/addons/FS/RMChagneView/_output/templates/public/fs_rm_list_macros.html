<xf:macro name="resource"
		  arg-filterPrefix="{{ false }}"
		  arg-resource="!"
		  arg-category="{{ null }}"
		  arg-showWatched="{{ true }}"
		  arg-allowInlineMod="{{ true }}"
		  arg-chooseName=""
		  arg-extraInfo="">

	<style>
		.slider-container {
			width: 100%;
			max-width: 600px;
			overflow: hidden;
			position: relative;
			margin: 0px auto;
		}

		.slider {
			display: flex;
			transition: transform 0.5s ease-in-out;
		}

		.slider img {
			width: 100%;
			flex-shrink: 0;
			height: 300px;
			object-fit: cover;
			display: none;
		}

		.slider img.active {
			display: block;
		}

		/* Left and right navigation buttons */
		.nav-button {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			background-color: #fff;
			color: #575f6d;
			border: none;
			cursor: pointer;
			font-size: 18px;
			z-index: 10;
		}

		.nav-button.left {
			left: 0px;
			border-radius: 0 10px 10px 0;
			padding: 2px 10px 2px 15px;
		}

		.nav-button.right {
			right: 0px;
			border-radius: 10px 0 0 10px;
			padding: 2px 15px 2px 10px;
		}
	</style>

	<xf:css src="structured_list.less" />

	<div class="structItem structItem--thread{{ $resource.prefix_id ? 'is-prefix' . $resource.prefix_id : '' }} {{ $resource.isIgnored() ? 'is-ignored' : '' }}{{ $resource.resource_state == 'moderated' ? 'is-moderated' : '' }}{{ $resource.resource_state == 'deleted' ? 'is-deleted' : '' }} js-inlineModContainer js-resourceListItem-{$resource.resource_id}" data-author="{{ $resource.User.username ?: $resource.username }}">

		<xf:extension name="icon_cell">

			<div class="structItem-cell structItem-cell--icon" style="width: {{ $thread.Forum.Node.node_thread_thumbnail_width ? $thread.Forum.Node.node_thread_thumbnail_width : $xf.options.thumbnail_width }}; height: {{ $thread.Forum.Node.node_thread_thumbnail_height ? $thread.Forum.Node.node_thread_thumbnail_height : $xf.options.thumb_size_hemant }};">

				<div class="structItem-iconContainer">
					<xf:if is="count($resource.Description.Attachments) == 1">
						<a href="{{ link('resources', $resource) }}" class="" data-tp-primary="on">

							<xf:foreach loop="$resource.Description.Attachments" value="$attachment" i="$i" if="$attachment.has_thumbnail">
								<img src="{$attachment.thumbnail_url}" alt="{$attachment.filename}" style="width: {$xf.options.fs_rm_resource_width_percen}%; height: {$xf.options.fs_rm_resource_height_pixcels}px; object-fit: cover; border-bottom: solid 2px #fa7d24" loading="lazy">
							</xf:foreach>
						</a>
						<xf:elseif is="count($resource.Description.Attachments) > 1"/>
						<div class="slider-container">
							<div class="slider">
								<xf:foreach loop="$resource.Description.Attachments" value="$attachment" i="$i" if="$attachment.has_thumbnail">
									<img src="{$attachment.thumbnail_url}" class="{{$i == 1 ? 'active' : ' '}}" alt="{$attachment.filename}" style="width: {$xf.options.fs_rm_resource_width_percen}%; height: {$xf.options.fs_rm_resource_height_pixcels}px; object-fit: cover; border-bottom: solid 2px #fa7d24" loading="lazy">
								</xf:foreach>
							</div>
							<button class="nav-button left">&lt;</button>
							<button class="nav-button right">&gt;</button>
						</div>
						<xf:else/>
						<a href="{{ link('resources', $resource) }}" class="" data-tp-primary="on">
							<img src="{$xf.options.fs_rm_m_bg_img}" alt="{$attachment.filename}" style="width: {$xf.options.fs_rm_resource_width_percen}%; height: {$xf.options.fs_rm_resource_height_pixcels}px; object-fit: cover; border-bottom: solid 2px #fa7d24" loading="lazy">
						</a>
					</xf:if>
				</div>
			</div>
		</xf:extension>

		<xf:extension name="main_cell">
			<div class="structItem-cell structItem-cell--main" data-xf-init="touch-proxy">

				<xf:if contentcheck="true">
					<ul class="structItem-statuses">
						<xf:contentcheck>
							<xf:extension name="statuses">

								<xf:if is="{$showWatched} AND {$xf.visitor.user_id}">
									<xf:if is="{$thread.Watch.{$xf.visitor.user_id}}">
										<li>
											<i class="structItem-status structItem-status--watched" aria-hidden="true" title="{{ phrase('thread_watched')|for_attr }}"></i>
											<span class="u-srOnly">{{ phrase('thread_watched') }}</span>
										</li>
									</xf:if>
								</xf:if>

							</xf:extension>
						</xf:contentcheck>
					</ul>
				</xf:if>

				<div class="structItem-title">
					<xf:if is="$resource.prefix_id">
						<xf:if is="$category">
							<a href="{{ link('resources/categories', $category, {'prefix_id': $resource.prefix_id}) }}" class="labelLink" rel="nofollow">{{ prefix('resource', $resource, 'html', '') }}</a>
							<xf:else />
							<xf:if is="$filterPrefix">
								<a href="{{ link('resources', null, {'prefix_id': $resource.prefix_id}) }}" class="labelLink" rel="nofollow">{{ prefix('resource', $resource, 'html', '') }}</a>
								<xf:else />
								{{ prefix('resource', $resource, 'html', '') }}
							</xf:if>
						</xf:if>
					</xf:if>
					<a href="{{ link('resources', $resource) }}" class="" data-tp-primary="on">{$resource.title}</a>
					<xf:if is="$resource.isVersioned()">
						<span class="u-muted">{$resource.CurrentVersion.version_string}</span>
					</xf:if>
					<xf:if is="$resource.isExternalPurchasable()">
						<span class="label label--primary label--smallest">{$resource.price|currency($resource.currency)}</span>
					</xf:if>
				</div>

				<div class="structItem-minor">
					<xf:comment>
						<xf:if contentcheck="true">
							<ul class="structItem-extraInfo">
								<xf:contentcheck>
									<xf:if is="{$extraInfo}">
										<li>{$extraInfo}</li>
									</xf:if>
									<xf:if is="$chooseName">
										<li><xf:checkbox standalone="true">
											<xf:option name="{$chooseName}[]" value="{$resource.resource_id}" class="js-chooseItem" />
											</xf:checkbox></li>
										<xf:elseif is="$allowInlineMod AND $resource.canUseInlineModeration()" />
										<li><xf:checkbox standalone="true"><xf:option value="{$resource.resource_id}"
																					  class="js-inlineModToggle"
																					  data-xf-init="tooltip" title="{{ phrase('select_for_moderation') }}" /></xf:checkbox></li>
									</xf:if>
								</xf:contentcheck>
							</ul>
						</xf:if>
					</xf:comment>

					<xf:if is="$resource.resource_state == 'deleted'">
						<xf:macro template="deletion_macros" name="notice" arg-log="{$resource.DeletionLog}" />
						<xf:else />
						<ul class="structItem-parts">
							<li><xf:username user="$resource.User" defaultname="{$resource.username}" /></li>
							<xf:if is="!$category OR $category.hasChildren()">
								<li><a href="{{ link('resources/categories', $resource.Category) }}">{$resource.Category.title}</a></li>
							</xf:if>
						</ul>
						<br/>
						{{ snippet($resource.Description.message, 50, {'stripBbCode': true}) }}
					</xf:if>
					<br/>
					<br/>
					<div class="structItem-cell--resourceMeta">
						<div class="structItem-metaItem  structItem-metaItem--rating">
							<xf:macro template="rating_macros" name="stars_text"
									  arg-rating="{$resource.rating_avg}"
									  arg-count="{$resource.rating_count}"
									  arg-rowClass="ratingStarsRow--justified"
									  arg-starsClass="ratingStars--larger" />
						</div>

					</div>
				</div>
			</div>
		</xf:extension>

	</div>

	<script>
		// Function to initialize sliders
		function initializeSliders() {
			const sliders = document.querySelectorAll('.slider-container');

			sliders.forEach((sliderContainer) => {
				const slider = sliderContainer.querySelector('.slider');
				const images = slider.getElementsByTagName('img');
				const imageCount = images.length;
				let currentIndex = 0;

				const leftButton = sliderContainer.querySelector('.nav-button.left');
				const rightButton = sliderContainer.querySelector('.nav-button.right');

				function changeSlide(index) {
					for (let img of images) {
						img.classList.remove('active');
					}
					images[index].classList.add('active');
				}

				// Left button click event
				leftButton.addEventListener('click', () => {
					currentIndex--;
					if (currentIndex < 0) {
						currentIndex = imageCount - 1;
					}
					changeSlide(currentIndex);
				});

				// Right button click event
				rightButton.addEventListener('click', () => {
					currentIndex++;
					if (currentIndex >= imageCount) {
						currentIndex = 0;
					}
					changeSlide(currentIndex);
				});

				// Initialize first slide
				changeSlide(currentIndex);
			});
		}

		// Initialize all sliders on the page
		window.onload = initializeSliders;
	</script>

</xf:macro>

<xf:comment>
	<xf:macro name="resource"
			  arg-filterPrefix="{{ false }}"
			  arg-resource="!"
			  arg-category="{{ null }}"
			  arg-showWatched="{{ true }}"
			  arg-allowInlineMod="{{ true }}"
			  arg-chooseName=""
			  arg-extraInfo="">

		<xf:css src="structured_list.less" />
		<xf:css src="xfrm.less" />

		<div class="structItem structItem--resource {{ $resource.prefix_id ? 'is-prefix' . $resource.prefix_id : '' }} {{ $resource.isIgnored() ? 'is-ignored' : '' }}{{ $resource.resource_state == 'moderated' ? 'is-moderated' : '' }}{{ $resource.resource_state == 'deleted' ? 'is-deleted' : '' }} js-inlineModContainer js-resourceListItem-{$resource.resource_id}" data-author="{{ $resource.User.username ?: $resource.username }}">
			<div class="structItem-cell structItem-cell--icon structItem-cell--iconExpanded">
				<div class="structItem-iconContainer">
					<xf:if is="$xf.options.xfrmAllowIcons">
						{{ resource_icon($resource, 's', link('resources', $resource)) }}
						<xf:avatar user="$resource.User" size="s"
								   href=""
								   class="avatar--separated structItem-secondaryIcon" />
						<xf:else />
						<xf:avatar user="$resource.User" size="s" defaultname="{$resource.username}" />
					</xf:if>
				</div>
			</div>
			<div class="structItem-cell structItem-cell--main" data-xf-init="touch-proxy">
				<xf:if contentcheck="true">
					<ul class="structItem-statuses">
						<xf:contentcheck>
							<xf:if is="$resource.Featured">
								<li>
									<i class="structItem-status structItem-status--attention" aria-hidden="true" title="{{ phrase('xfrm_featured')|for_attr }}"></i>
									<span class="u-srOnly">{{ phrase('xfrm_featured') }}</span>
								</li>
							</xf:if>
							<xf:if is="$resource.isNonOwnerTeamMember()">
								<li>
									<i class="structItem-status structItem-status--team" aria-hidden="true" title="{{ phrase('xfrm_team_member')|for_attr }}"></i>
									<span class="u-srOnly">{{ phrase('xfrm_team_member') }}</span>
								</li>
							</xf:if>
							<xf:if is="$resource.resource_state == 'moderated'">
								<li>
									<i class="structItem-status structItem-status--moderated" aria-hidden="true" title="{{ phrase('awaiting_approval')|for_attr }}"></i>
									<span class="u-srOnly">{{ phrase('awaiting_approval') }}</span>
								</li>
							</xf:if>
							<xf:if is="$resource.resource_state == 'deleted'">
								<li>
									<i class="structItem-status structItem-status--deleted" aria-hidden="true" title="{{ phrase('deleted')|for_attr }}"></i>
									<span class="u-srOnly">{{ phrase('deleted') }}</span>
								</li>
							</xf:if>
							<xf:if is="{$showWatched} AND {$xf.visitor.user_id}">
								<xf:if is="{$resource.Watch.{$xf.visitor.user_id}}">
									<li>
										<i class="structItem-status structItem-status--watched" aria-hidden="true" title="{{ phrase('xfrm_resource_watched')|for_attr }}"></i>
										<span class="u-srOnly">{{ phrase('xfrm_resource_watched') }}</span>
									</li>
									<xf:elseif is="!$category AND {$resource.Category.Watch.{$xf.visitor.user_id}}" />
									<li>
										<i class="structItem-status structItem-status--watched" aria-hidden="true" title="{{ phrase('xfrm_category_watched')|for_attr }}"></i>
										<span class="u-srOnly">{{ phrase('xfrm_category_watched') }}</span>
									</li>
								</xf:if>
							</xf:if>
						</xf:contentcheck>
					</ul>
				</xf:if>

				<div class="structItem-title">
					<xf:if is="$resource.prefix_id">
						<xf:if is="$category">
							<a href="{{ link('resources/categories', $category, {'prefix_id': $resource.prefix_id}) }}" class="labelLink" rel="nofollow">{{ prefix('resource', $resource, 'html', '') }}</a>
							<xf:else />
							<xf:if is="$filterPrefix">
								<a href="{{ link('resources', null, {'prefix_id': $resource.prefix_id}) }}" class="labelLink" rel="nofollow">{{ prefix('resource', $resource, 'html', '') }}</a>
								<xf:else />
								{{ prefix('resource', $resource, 'html', '') }}
							</xf:if>
						</xf:if>
					</xf:if>
					<a href="{{ link('resources', $resource) }}" class="" data-tp-primary="on">{$resource.title}</a>
					<xf:if is="$resource.isVersioned()">
						<span class="u-muted">{$resource.CurrentVersion.version_string}</span>
					</xf:if>
					<xf:if is="$resource.isExternalPurchasable()">
						<span class="label label--primary label--smallest">{$resource.price|currency($resource.currency)}</span>
					</xf:if>
				</div>

				<div class="structItem-minor">
					<xf:if contentcheck="true">
						<ul class="structItem-extraInfo">
							<xf:contentcheck>
								<xf:if is="{$extraInfo}">
									<li>{$extraInfo}</li>
								</xf:if>
								<xf:if is="$chooseName">
									<li><xf:checkbox standalone="true">
										<xf:option name="{$chooseName}[]" value="{$resource.resource_id}" class="js-chooseItem" />
										</xf:checkbox></li>
									<xf:elseif is="$allowInlineMod AND $resource.canUseInlineModeration()" />
									<li><xf:checkbox standalone="true"><xf:option value="{$resource.resource_id}"
																				  class="js-inlineModToggle"
																				  data-xf-init="tooltip" title="{{ phrase('select_for_moderation') }}" /></xf:checkbox></li>
								</xf:if>
							</xf:contentcheck>
						</ul>
					</xf:if>

					<xf:if is="$resource.resource_state == 'deleted'">
						<xf:macro template="deletion_macros" name="notice" arg-log="{$resource.DeletionLog}" />
						<xf:else />
						<ul class="structItem-parts">
							<li><xf:username user="$resource.User" defaultname="{$resource.username}" /></li>
							<li class="structItem-startDate"><a href="{{ link('resources', $resource) }}" rel="nofollow"><xf:date time="{$resource.resource_date}" /></a></li>
							<xf:if is="!$category OR $category.hasChildren()">
								<li><a href="{{ link('resources/categories', $resource.Category) }}">{$resource.Category.title}</a></li>
							</xf:if>
						</ul>
					</xf:if>
				</div>


				<xf:if is="$resource.resource_state != 'deleted'">
					<div class="structItem-resourceTagLine">{$resource.tag_line}</div>
				</xf:if>
			</div>
			<div class="structItem-cell structItem-cell--resourceMeta">
				<div class="structItem-metaItem  structItem-metaItem--rating">
					<xf:macro template="rating_macros" name="stars_text"
							  arg-rating="{$resource.rating_avg}"
							  arg-count="{$resource.rating_count}"
							  arg-rowClass="ratingStarsRow--justified"
							  arg-starsClass="ratingStars--larger" />
				</div>

				<xf:if is="$resource.isDownloadable()">
					<dl class="pairs pairs--justified structItem-minor structItem-metaItem structItem-metaItem--downloads">
						<dt>{{ phrase('xfrm_downloads') }}</dt>
						<dd>{$resource.download_count|number}</dd>
					</dl>
				</xf:if>
				<dl class="pairs pairs--justified structItem-minor structItem-metaItem structItem-metaItem--lastUpdate">
					<dt>{{ phrase('updated') }}</dt>
					<dd><a href="{{ link('resources/updates', $resource) }}" class="u-concealed"><xf:date time="{$resource.last_update}" /></a></dd>
				</dl>
			</div>
		</div>
	</xf:macro>

	<xf:macro name="resource_simple" arg-resource="!" arg-withMeta="{{ true }}">
		<div class="contentRow">
			<div class="contentRow-figure">
				<xf:if is="$xf.options.xfrmAllowIcons">
					{{ resource_icon($resource, 'xxs', link('resources', $resource)) }}
					<xf:else />
					<xf:avatar user="$resource.User" size="xxs" />
				</xf:if>
			</div>
			<div class="contentRow-main contentRow-main--close">
				<a href="{{ link('resources', $resource) }}">{{ prefix('resource', $resource) }}{$resource.title}</a>
				<div class="contentRow-lesser">{$resource.tag_line}</div>
				<xf:if is="$withMeta">
					<div class="contentRow-minor contentRow-minor--smaller">
						<ul class="listInline listInline--bullet">
							<li>{{ $resource.User.username ?: $resource.username }}</li>
							<li>{{ phrase('updated:') }} <xf:date time="{$resource.last_update}" /></li>
						</ul>
					</div>
				</xf:if>
			</div>
		</div>
	</xf:macro>
</xf:comment>