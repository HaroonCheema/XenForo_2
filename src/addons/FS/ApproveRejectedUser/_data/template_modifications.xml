<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="approval_queue" modification_key="fs_rejected_user_approval_queue" description="add filter 'Username or Email' in fiter bar" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:if is="\$filters\.order AND {\$sortOrders\.{\$filters\.order}}">.*?<\/xf:if>.*?<\/xf:if>/si]]></find>
    <replace><![CDATA[$0
<xf:if is="$filters.content_id">
	<xf:set var="$user" value="{{ $xf.app.em.find('Xf:User', $filters.content_id) }}" />

	<li><a href="{{ link('approval-queue', null, $filters|replace({'content_id': null})) }}"
		   class="filterBar-filterToggle" data-xf-init="tooltip" title="{{ phrase('remove_this_filter')|for_attr }}">
		<span class="filterBar-filterToggle-label">{{ phrase('username_or_email:') }}</span>
		{{  $filters.isEmail ? $user.email : $user.username }}
		</a></li>
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="approval_queue_filters" modification_key="fs_rejected_user_approval_queue_filters_add_user" description="Add input field 'usernameOrEmail'" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:above_sort_direction]-->]]></find>
    <replace><![CDATA[<!--[XF:above_username_or_email]-->
<div class="menu-row menu-row--separated">
	<label for="ctrl_content_type">{{ phrase('username_or_email:') }}</label>
	<div class="u-inputSpacer">

		<xf:set var="$user" value="{{ $filters.content_id ? $xf.app.em.find('Xf:User', $filters.content_id) : '' }}" />

		<xf:textbox name="username" ac="single" value="{{ $user? $filters.isEmail ? $user.email : $user.username : '' }}" maxlength="{{ max_length($xf.visitor, 'username') }}" />
	</div>
</div>
$0]]></replace>
  </modification>
  <modification type="public" template="approval_queue_macros" modification_key="fs_rejected_user_approval_queue_macros" description="fs_rejected_user_approval_queue_macros" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[{$typePhraseHtml|raw}]]></find>
    <replace><![CDATA[{{$user.user_state == 'rejected'? phrase('fs_rejected_user') : $typePhraseHtml|raw}}]]></replace>
  </modification>
</template_modifications>
