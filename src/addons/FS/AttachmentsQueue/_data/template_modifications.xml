<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="PAGE_CONTAINER" modification_key="fs_attachment_queue_approval_page_container" description="fs_attachment_queue_approval_page_container" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:if is="$xf.visitor.is_moderator && $xf.session.unapprovedCounts.total">]]></find>
    <replace><![CDATA[<xf:if is="$xf.visitor.is_admin || $xf.visitor.is_moderator && $xf.session.fsAttachmentsPendingCount.total">
	<a href="{{ link('attachment-queue') }}"
	   class="p-staffBar-link badgeContainer badgeContainer--highlighted"
	   data-badge="{{ $xf.session.fsAttachmentsPendingCount.total|number}}">
		{{ phrase('fs_attachment_queue_approval_title') }}
	</a>
</xf:if>

$0]]></replace>
  </modification>
  <modification type="public" template="attachment_macros" modification_key="fs_attachment_queue_replace_non_embed" description="fs_attachment_queue_replace_non_embed" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<a class="file-preview {{ \$canView \? 'js-lbImage' : '' }}" href="{\$attachment\.direct_url}" target="_blank">.*?<\/a>/is]]></find>
    <replace><![CDATA[<xf:if is="$attachment.content_type == 'post' && $attachment.attachment_state == 'pending'">
	<a class="file-preview {{ $canView ? 'js-lbImage' : '' }}" href="{$xf.options.fs_attachment_queue_pending_img}" target="_blank">
		<img src="{$xf.options.fs_attachment_queue_pending_img}" alt="{$attachment.filename}"
			 width="{$attachment.thumbnail_width}" height="{$attachment.thumbnail_height}" loading="lazy" />
	</a>
	<xf:elseif is="$attachment.content_type == 'post' && $attachment.attachment_state == 'rejected'" />
	<a class="file-preview {{ $canView ? 'js-lbImage' : '' }}" href="{$xf.options.fs_attachment_queue_rejected_img}" target="_blank">
		<img src="{$xf.options.fs_attachment_queue_rejected_img}" alt="{$attachment.filename}"
			 width="{$attachment.thumbnail_width}" height="{$attachment.thumbnail_height}" loading="lazy" />
	</a>
	<xf:else />
	$0
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="bb_code_tag_attach" modification_key="fs_attachment_queue_replace_from_post_full" description="fs_attachment_queue_replace_from_post_full" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<img src="{{ link\('full:attachments', \$attachment, {'hash': \$attachment\.temp_hash}\) }}".*?width="{\$attachment\.width}" height="{\$attachment\.height}" loading="lazy" \/>/is]]></find>
    <replace><![CDATA[<xf:if is="{{$attachment.content_type == 'post' && $attachment.attachment_state == 'pending'}}">
	<img src="{$xf.options.fs_attachment_queue_pending_img}"
		 class="bbImage {$alignClass}"
		 style="{$styleAttr}"
		 alt="{$alt}"
		 title="{$alt}"
		 width="{$attachment.width}" height="{$attachment.height}" loading="lazy" />
	<xf:elseif is="$attachment.content_type == 'post' && $attachment.attachment_state == 'rejected'" />
	<img src="{$xf.options.fs_attachment_queue_rejected_img}"
		 class="bbImage {$alignClass}"
		 style="{$styleAttr}"
		 alt="{$alt}"
		 title="{$alt}"
		 width="{$attachment.width}" height="{$attachment.height}" loading="lazy" />
	<xf:else />
	$0
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="bb_code_tag_attach" modification_key="fs_attachment_queue_replace_from_post_thumb" description="fs_attachment_queue_replace_from_post_thumb" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:macro template="lightbox_macros" name="setup" arg-canViewAttachments="{\$canView}" \/>.*?width="{\$attachment\.thumbnail_width}" height="{\$attachment\.thumbnail_height}" loading="lazy" \/><\/a>/is]]></find>
    <replace><![CDATA[<xf:if is="{{$attachment.content_type == 'post' && $attachment.attachment_state == 'pending'}}">
	<xf:macro template="lightbox_macros" name="setup" arg-canViewAttachments="{$canView}" />
	<a href="{$xf.options.fs_attachment_queue_pending_img}"
	   target="_blank" class="js-lbImage"><img src="{$xf.options.fs_attachment_queue_pending_img}"
											   class="bbImage {$alignClass}"
											   style="{$styleAttr}"
											   alt="{$alt}"
											   title="{$alt}"
											   width="{$attachment.thumbnail_width}" height="{$attachment.thumbnail_height}" loading="lazy" /></a>
	<xf:elseif is="$attachment.content_type == 'post' && $attachment.attachment_state == 'rejected'" />
	<xf:macro template="lightbox_macros" name="setup" arg-canViewAttachments="{$canView}" />
	<a href="{$xf.options.fs_attachment_queue_rejected_img}"
	   target="_blank" class="js-lbImage"><img src="{$xf.options.fs_attachment_queue_rejected_img}"
											   class="bbImage {$alignClass}"
											   style="{$styleAttr}"
											   alt="{$alt}"
											   title="{$alt}"
											   width="{$attachment.thumbnail_width}" height="{$attachment.thumbnail_height}" loading="lazy" /></a>
	<xf:else />
	$0
</xf:if>]]></replace>
  </modification>
</template_modifications>
