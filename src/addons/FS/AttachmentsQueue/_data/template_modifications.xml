<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="PAGE_CONTAINER" modification_key="fs_attachment_queue_approval_page_container" description="fs_attachment_queue_approval_page_container" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:if is="$xf.visitor.is_moderator && $xf.session.unapprovedCounts.total">]]></find>
    <replace><![CDATA[<xf:if is="$xf.visitor.is_admin || $xf.visitor.is_moderator && $xf.session.fsAttachmentsPendingCount.total">
	<a href="{{ link('attachment-queue') }}"
	   class="p-staffBar-link badgeContainer badgeContainer--highlighted"
	   data-badge="{{ $xf.session.fsAttachmentsPendingCount.total|number}}">
		{{ phrase('fs_attachment_queue_approval_title') }}
	</a>
</xf:if>

$0]]></replace>
  </modification>
  <modification type="public" template="bb_code_tag_attach" modification_key="fs_attachment_queue_replace_from_post_full" description="fs_attachment_queue_replace_from_post_full" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<img src="{{ link\('full:attachments', \$attachment, {'hash': \$attachment\.temp_hash}\) }}".*?width="{\$attachment\.width}" height="{\$attachment\.height}" loading="lazy" \/>/is]]></find>
    <replace><![CDATA[<xf:if is="{{$attachment.content_type == 'post' && ($attachment.attachment_state == 'pending' || $attachment.attachment_state == 'rejected') && $attachment.Data.user_id != $xf.visitor.user_id}}">
	
	<xf:else />
	$0
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="bb_code_tag_attach" modification_key="fs_attachment_queue_replace_from_post_thumb" description="fs_attachment_queue_replace_from_post_thumb" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:macro template="lightbox_macros" name="setup" arg-canViewAttachments="{\$canView}" \/>.*?width="{\$attachment\.thumbnail_width}" height="{\$attachment\.thumbnail_height}" loading="lazy" \/><\/a>/is]]></find>
    <replace><![CDATA[<xf:if is="{{$attachment.content_type == 'post' && ($attachment.attachment_state == 'pending' || $attachment.attachment_state == 'rejected') && $attachment.Data.user_id != $xf.visitor.user_id}}">

	<xf:else />
	$0
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="bb_code_tag_attach" modification_key="fs_attachment_queue_tag_attach" description="fs_attachment_queue_tag_attach" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:macro name="lightbox_macros::single_image".*\/>/isU]]></find>
    <replace><![CDATA[<xf:if is="{{$attachment.content_type == 'post' && ($attachment.attachment_state == 'pending' || $attachment.attachment_state == 'rejected') && $attachment.Data.user_id != $xf.visitor.user_id}}">

	<xf:else />
	$0
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="message_macros" modification_key="fs_attachment_queue_message_macros" description="fs_attachment_queue_message_macros_hide_from_others" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:macro template="attachment_macros" name="attachment_list_item".*?arg-canView="{\$canView}" \/>/is]]></find>
    <replace><![CDATA[<xf:if is="$attachment.content_type == 'post' && ($attachment.attachment_state == 'pending' || $attachment.attachment_state == 'rejected') && $attachment.Data.user_id != $xf.visitor.user_id">
	<xf:else />
	$0
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="post_macros" modification_key="fs_attachment_queue_hide_attachment" description="fs_attachment_queue_hide_attachment" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:if is="\$post\.attach_count">.*?<\/xf:if>/is]]></find>
    <replace><![CDATA[<xf:if is="$post.attach_count && $xf.visitor.user_id">
	<xf:macro template="message_macros" name="attachments"
			  arg-attachments="{$post.Attachments}"
			  arg-message="{$post}"
			  arg-canView="{{ $thread.canViewAttachments() }}" />
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="post_macros" modification_key="fs_attachment_queue_post_macros_notice_in_awaiting" description="fs_attachment_queue_post_macros_notice_in_awaiting" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:extension name="content">]]></find>
    <replace><![CDATA[$0

<xf:if is="{{$xf.visitor.user_id == $post.user_id && $post.getAwaitingApproval()}}">

		<div class="messageNotice messageNotice--moderated">
			{{ phrase('fs_this_message_is_awaiting_moderator_approval_and_is_invisible_to_normal') }}
		</div>
</xf:if>]]></replace>
  </modification>
</template_modifications>
