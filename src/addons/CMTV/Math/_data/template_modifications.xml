<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="CMTV_Math_js" modification_key="cmtv_math_hide_renderMathInElement" description="cmtv_math_hide_renderMathInElement" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[renderMathInElement(document.body, CMTV_MATH_RENDER_OPTIONS);]]></find>
    <replace><![CDATA[]]></replace>
  </modification>
  <modification type="public" template="CMTV_Math_katex" modification_key="cmtv_math_replace_library" description="cmtv_math_replace_library" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>]]></find>
    <replace><![CDATA[<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>]]></replace>
  </modification>
  <modification type="public" template="PAGE_CONTAINER" modification_key="cmtv_math_add_js_script" description="cmtv_math_add_js_script" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:set var="$description"><xf:description /></xf:set>]]></find>
    <replace><![CDATA[$0

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
 <script>
	 
      MathJax = {
		  
        options: {
          renderActions: {
            find: [
              10,
              function (doc) {
				  
                for (const node of document.querySelectorAll("formula")) {
			
                  const math = new doc.options.MathItem(
                    node.textContent,
                    doc.inputJax[0],
                    false
                  );
                  const text = document.createTextNode("");
                  node.parentNode.replaceChild(text, node);
                  math.start = { node: text, delim: "", n: 0 };
                  math.end = { node: text, delim: "", n: 0 };
                  doc.math.push(math);
                }
              },
              "",
            ],
          },
        },
      };
    </script>]]></replace>
  </modification>
  <modification type="public" template="editor" modification_key="CMTV_Math_editor_button" description="Adding &quot;Insert math&quot; button to Froala editor" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:include_js]-->]]></find>
    <replace><![CDATA[$0
<xf:js src="CMTV/Math/insert-math-button.js" min="1" addon="CMTV/Math" />]]></replace>
  </modification>
  <modification type="public" template="editor" modification_key="CMTV_Math_editor_button_phrase" description="Adding &quot;Insert math&quot; button phrase" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA["__lang end__": ""]]></find>
    <replace><![CDATA["CMTV_Math_insert_math": "{{ phrase('CMTV_Math_insert_math')|escape('json') }}",
$0]]></replace>
  </modification>
  <modification type="public" template="helper_js_global" modification_key="CMTV_Math_js" description="Loading &quot;Math&quot; addon scripts" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--XF:JS-->]]></find>
    <replace><![CDATA[$0
<xf:include template="CMTV_Math_js" />]]></replace>
  </modification>
  <modification type="public" template="helper_js_global" modification_key="CMTV_Math_katex" description="Loading KaTeX and applying styles" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--XF:CSS-->]]></find>
    <replace><![CDATA[$0
<xf:include template="CMTV_Math_katex" />
<xf:css src="CMTV_Math.less" />]]></replace>
  </modification>
</template_modifications>
