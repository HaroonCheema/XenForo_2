!function(d,h,f){h.getWebsocketsPromise=function(){return new Promise(function(a,b){if(XF.Echo)a({echo:XF.Echo,manager:XF.EchoManager});else d(f).on("websockets:connected",function(c,e){a({echo:e.echo,manager:e})})})};var m=XF.Cookie.get("csrf"),k=!1;(function(){return new Promise(function(a,b){if(m||k)a({keepAlive:!1});else{var c=XF.CrossTab.trigger.bind(XF.CrossTab),e="keepAlive"+XF.stringHashCode(XF.config.url.keepAlive);XF.CrossTab.trigger=function(l,g,n){g=c(l,g,n);l===e&&setTimeout(function(){a({keepAlive:!0})},
100);k=!0;return g}}})})().then(function(){XF.Echo=new Echo(function(){var a={namespace:"",broadcaster:"pusher",key:XF.config.echo.key,forceTLS:!1,encrypted:!0,disableStats:!0,enabledTransports:["ws","wss"],csrfToken:XF.config.csrf,cluster:XF.config.echo.cluster,authEndpoint:XF.config.echo.authEndpoint,userAuthentication:{endpoint:XF.config.echo.userAuthEndpoint,headers:{"X-XF-Csrf-Token":XF.config.csrf}},auth:{headers:{"X-XF-Csrf-Token":XF.config.csrf}}};a.cluster||(a=d.extend(a,{wsHost:XF.config.echo.host||
h.location.host,wsPort:XF.config.echo.port,wssPort:XF.config.echo.port}));return a}());XF.EchoManager=d.extend(XF.EchoManager||{},{channels:{},init:function(){this.echo=XF.Echo;this.joinDefaultChannels();this.addPageUidToAjaxHeaders();this.listenKeepAlive();d(f).trigger("websockets:connected",[this])},listenKeepAlive:function(){var a=this,b="keepAlive"+XF.stringHashCode(XF.config.url.keepAlive);XF.CrossTab.on(b,function(){a.updateCsrfInConnector()})},updateCsrfInConnector:function(){var a=XF.config.csrf,
b=function(c){c.csrfToken=a;c.userAuthentication.headers["X-CSRF-TOKEN"]=a;c.auth.headers["X-CSRF-TOKEN"]=a;c.userAuthentication.headers["X-XF-Csrf-Token"]=a;c.auth.headers["X-XF-Csrf-Token"]=a};b(XF.Echo.connector.options);b(XF.Echo.options)},joinDefaultChannels:function(){this.channels.forum=this.echo["private"]("Forum");XF.config.userId&&(this.channels.visitor=this.echo["private"]("User."+XF.config.userId))},addPageUidToAjaxHeaders:function(){d(f).on("ajax:send",function(a,b){b.setRequestHeader("X-WebSockets-Page-Uid",
XF.config.echo.pageUid)})}});XF.EchoManager.init()})}(window.jQuery,window,document);