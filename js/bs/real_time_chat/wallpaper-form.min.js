'use strict';!function(){var c=window.jQuery;XF.RtcWallpaperForm=XF.Element.newHandler({options:{},wallpaper:{url:"",blurred:!1},wasSubmitted:!1,init(){if(this.chat=this.$target.rtc(!0),!this.chat)throw Error("Could not find chat");var a=this.$target.closest(".js-message");a=a.length?a:this.$target;this.$themeIndex=a.find(".js-themeIndex");this.$uploadInputs=a.find(".js-uploadInputs");this.$uploadInput=a.find(".js-uploadInput");this.$uploadButton=a.find(".js-uploadButton");this.$uploadButton.data("original-label",
this.$uploadButton.text());this.$imageManage=a.find(".js-imageManage");this.$blurred=a.find('input[name="blurred"]');this.$uploadInput.on("change",XF.proxy(this,"onUploadInputChanged"));this.$blurred.on("change",XF.proxy(this,"onBlurredChanged"));a.on("click",".js-theme",XF.proxy(this,"onThemeClick"));a.on("click",".js-resetWallpaper",XF.proxy(this,"onResetWallpaperClick"));this.$uploadButton.on("click",XF.proxy(this,"onUploadButtonClick"));this.$target.on("submit",XF.proxy(this,"onSubmit"));this.assertBlocksVisibility();
this.$target.closest(".js-message")?.saveScrollPositionOnResize();a.onRemoved(()=>{this.wasSubmitted?this.wasSubmitted=!1:(this.resetWallpaperImage(),this.chat.resetTheme())})},onResetWallpaperClick(a){this.chat.updateTheme(this.chat.options.theme);this.resetWallpaperImage()},onSubmit(){this.wasSubmitted=!0;this.wallpaper.url=""},onUploadInputChanged(a){if(!a.target.files.length)return void(this.wallpaper.url="");this.wallpaper.url=URL.createObjectURL(a.target.files[0]);this.updateWallpaperImage();
this.assertBlocksVisibility();this.updateUploadButtonLabel()},onBlurredChanged(a){this.wallpaper.blurred=a.target.checked;this.updateWallpaperImage()},updateUploadButtonLabel(){this.wallpaper.url?this.$uploadButton.text(this.$uploadButton.data("reset")):this.$uploadButton.text(this.$uploadButton.data("original-label"))},updateWallpaperImage(){this.chat.$target.css(this.getWallpaperProps())},getWallpaperProps(){const a={"--wallpaper-image":`url(${this.wallpaper.url})`,"--wallpaper-filter":"none","--wallpaper-size":"cover",
"--wallpaper-repeat":"no-repeat","--wallpaper-color":"transparent","--wallpaper-mask":"none"};return this.wallpaper.blurred&&(a["--wallpaper-filter"]="blur(5px)"),a},onThemeClick(a){a.preventDefault();a=c(a.currentTarget);const b=parseInt(a.data("themeIndex"),10);this.$themeIndex.val(b);this.$target.find(".js-theme.selected").removeClass("selected");a.addClass("selected");-1===b?this.chat.resetTheme():this.chat.updateTheme(a.data("theme"));this.updateWallpaperImage();this.assertBlocksVisibility()},
onUploadButtonClick(a){a.preventDefault();this.wallpaper.url?this.resetWallpaperImage():(this.$uploadInput.trigger("click"),this.$uploadButton.blur())},resetWallpaperImage(){this.wallpaper.url="";this.$uploadInput.val("");this.updateWallpaperImage();this.assertBlocksVisibility();this.updateUploadButtonLabel()},assertBlocksVisibility(){const a=parseInt(this.$themeIndex.val(),10);this.$uploadInputs.each((b,d)=>{b=c(d);-1===a&&"none"===b.css("display")&&b.xfFadeDown(XF.config.speed.fast);-1!==a&&"none"!==
b.css("display")&&b.xfFadeUp(XF.config.speed.fast)});this.wallpaper.url&&"none"===this.$imageManage.css("display")&&this.$imageManage.xfFadeDown(XF.config.speed.fast);this.wallpaper.url||"none"===this.$imageManage.css("display")||this.$imageManage.xfFadeUp(XF.config.speed.fast)}});XF.Element.register("rtc-wallpaper-form","XF.RtcWallpaperForm")}();