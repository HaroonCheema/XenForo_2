var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(d){return d.raw=d};$jscomp.createTemplateTagFirstArgWithRaw=function(d,f){d.raw=f;return d};
!function(){!function(d,f,g){String.prototype.replaceTagsToValues=String.prototype.replaceTagsToValues||function(a){var b=this,c;for(c in a)b=b.replace(new RegExp("<"+c+">","g"),a[c]);return b};XF.Messenger=d.extend(XF.Messenger||{},{noticesUrl:"",popupUrl:"",popup:null,enableSound:!1,soundPath:"",$audio:null,init:function(){var a=this,b;d(g).on("xfm:lk",function(){return console.log("dc1953fe3def09d484260b31339265fce6879d3086100101291812eadaf37d67")});this.noticesUrl=XF.config.messenger.noticesUrl;this.popupUrl=XF.config.messenger.popupUrl;
null==(b=f.getWebsocketsPromise)||b.call(f).then(function(c){c.manager.channels.visitor.listen("XFM.NewMessage",XF.proxy(a,"onNewMessage"))});XF.config.messenger.popupEnabled&&(this.popup=new XF.ChatPopup({url:this.popupUrl,eventPrefix:"XFM",draggable:!0}),this.isValidPage()&&this.popup.setupFromCookie());XF.config.messenger.enableSound&&(this.enableSound=!0,this.soundPath=XF.config.messenger.soundPath,this.$audio=d("<audio />").attr("src",this.soundPath).appendTo(g.body))},isValidPage:function(){return!this.isConversationsPage()&&
!this.isAdminPage()},isConversationsPage:function(){var a;return!(null==(a=f.location.href.match(/conversations/))||!a.length)},isAdminPage:function(){var a;return!(null==(a=f.location.href.match(/admin\.php/))||!a.length)},onNewMessage:function(a){var b=this,c=a.message;c.user_id===XF.config.userId||!this.isValidPage()||this.popup&&this.popup.isOpened()||(function(){if(!b.enableSound)return!1;var e=b.getSoundConfig();e=e[c.room_tag]||e[parseInt(c.room_tag,10)];return void 0===e||!!e&&!g.hasFocus()}()&&
this.playSound(),XF.ajax("GET",this.noticesUrl.replaceTagsToValues({tag:c.room_tag}),{start_message_id:c.id},function(e){XF.setupHtmlInsert(e.html,function(h){g.hasFocus()?b.showFloatingNotices(h):d(g).one("focus",function(){b.showFloatingNotices(h)})})},{global:!1}))},showFloatingNotices:function(a){var b=d(".js-notices.notices--floating");b.length||(b=d('<ul class="notices notices--floating js-notices" data-xf-init="notices" data-type="floating" />').appendTo(d(".u-bottomFixer")));a.on("click",
".js-locationChanger",function(c){c.preventDefault();c=d(c.currentTarget);f.location.href=c.data("href")});a.appendTo(b);XF.activate(a);XF.activate(b);this.setupNoticesDestructTimer(a);a=XF.Element.getHandler(b,"notices");a.updateNoticeList();a.filter();a.start()},setupNoticesDestructTimer:function(a){a.find(".js-notice").each(function(b,c){var e=d(c),h=e.data("display-duration"),k,l=function(){e.xfFadeUp(XF.config.speed.slow,function(){e.remove()})};h&&(k=setTimeout(l,h));e.find(".js-alertToggle").click(function(){k&&
clearTimeout(k);l()})})},playSound:function(){this.$audio[0].play()},getSoundConfig:function(){return XF.Cookie.getJson(this.getSoundConfigCookieName())||{}},getSoundConfigCookieName:function(){return"xfm_chat_sound"}});d(function(){return XF.Messenger.init()})}(window.jQuery,window,document)}();