var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(b){return b.raw=b};$jscomp.createTemplateTagFirstArgWithRaw=function(b,a){b.raw=a;return b};$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};
$jscomp.makeIterator=function(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if(a)return a.call(b);if("number"==typeof b.length)return $jscomp.arrayIterator(b);throw Error(String(b)+" is not an iterable or ArrayLike");};$jscomp.getRestArguments=function(){for(var b=Number(this),a=[],c=b;c<arguments.length;c++)a[c-b]=arguments[c];return a};
!function(){var b=window.jQuery;XF.MessengerRoomsSearch=XF.Element.newHandler({options:{searchUrl:""},loading:!1,searchType:"conversations",lastSearchQuery:"",init:function(){var a=this,c=this.$target.closest(".left-column");this.$chat=this.$target.rtc();(this.chat=this.$chat.rtc(!0))||this.$chat.on("chat:init",function(){a.chat=a.$chat.rtc(!0)});this.$box=this.$target.closest(".js-searchBox");this.$filters=this.$box.find(".js-searchFilters");this.$container=c.find(".js-searchContainer");this.$results=
this.$container.find(".js-searchResults");this.$loader=this.$container.find(".js-loader");this.$target.on("focus",XF.proxy(this,"onFocus"));this.$container.on("click",".js-searchTab",XF.proxy(this,"onSearchTabClick"));this.$container.on("click",".js-roomResult",XF.proxy(this,"onRoomResultClick"));this.$container.on("click",".js-searchClose",XF.proxy(this,"onSearchCloseClick"));this.$box.on("click",".js-searchReset",XF.proxy(this,"onSearchResetClick"));this.$box.on("click",".js-searchClose",XF.proxy(this,
"onSearchCloseClick"));this.$target.on("keydown paste",this._throttle(function(){a.$target.val()&&!a.$box.hasClass("has-query")?a.$box.addClass("has-query"):!a.$target.val()&&a.$box.hasClass("has-query")&&a.$box.removeClass("has-query");a.$target.val()!==a.lastSearchQuery&&a.loadSearchResults()},400));this.$filters.on("change",XF.proxy(this,"loadSearchResults"))},onFocus:function(){this.$box.addClass("is-active");this.$container.addClass("is-active");this.chat.rooms.$placeholder.removeClass("visible");
this.loadSearchResults()},onSearchTabClick:function(a){(a.preventDefault(),this.loading)||(a=b(a.currentTarget),this.setSearchType(a.data("type")),this.$container.find(".js-searchTab.is-active").removeClass("is-active"),a.addClass("is-active"))},onRoomResultClick:function(a){a.preventDefault();a=b(a.currentTarget);var c=a.data("room-tag");c=this.chat.$roomItems.find('.js-room[data-room-tag="'+c+'"]');c.length?this.chat.rooms.open(c):this.chat.rooms.open(a)},onSearchResetClick:function(a){a.preventDefault();
this.$target.val("");this.$box.removeClass("has-query");this.loadSearchResults()},onSearchCloseClick:function(a){a.preventDefault();this.resetSearchForm()},setSearchType:function(a){this.searchType=a;this.loadSearchResults()},loadSearchResults:function(){var a=this;if(!this.loading){this.$results.html("");this.loading=!0;this.$loader.addClass("is-active");var c=new FormData(this.$filters[0]);c.append("q",this.$target.val());c.append("type",this.searchType);this.lastSearchQuery=c.get("q");var d={};
c=$jscomp.makeIterator(c.entries());for(var e=c.next();!e.done;e=c.next()){var f=$jscomp.makeIterator(e.value);e=f.next().value;f=f.next().value;d[e]=f}XF.ajax("GET",this.options.searchUrl,d,function(h){XF.setupHtmlInsert(h.html,function(g){a.$results.html(g)})},{global:!1}).always(function(){a.loading=!1;a.$loader.removeClass("is-active")})}},resetSearchForm:function(){this.$filters[0].reset();this.$target.val("");this.$box.removeClass("is-active has-query");this.$container.removeClass("is-active");
this.chat.rooms.updatePlaceholder()},_throttle:function(a,c){var d=null,e=0;return function(){var f=$jscomp.getRestArguments.apply(0,arguments),h=this,g=Date.now(),k=c-(g-e);0>=k||k>c?(d&&(clearTimeout(d),d=null),e=g,a.apply(this,f)):d||(d=setTimeout(function(){e=Date.now();d=null;a.apply(h,f)},k))}}});XF.Element.register("messenger-rooms-search","XF.MessengerRoomsSearch")}();