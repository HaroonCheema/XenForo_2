!function(d,c,a,e){function b(h,g){var f=d(".noEmptySlotsError");if(h.noSlotsError===undefined){f.remove()}else{if(!f.length){g.after('<p class="noEmptySlotsError">'+h.noSlotsError+" "+XF.phrase("siropu_ads_manager_you_can_still_create_ad")+"</p>")}}}XF.SAMCreate=XF.Element.newHandler({options:{adType:"banner",adId:0,costAmount:0,costCurrency:"USD",costPer:"month",costCustom:0,minPurchase:1,extend:false},init:function(){var f=this;d('input[name="exclusive_use"]').on("change",function(){if(!d(this).is(":checked")){return}var i=f.$target.find('textarea[name="content_1"]').val().trim();if(!i){XF.flashMessage(XF.phrase("siropu_ads_manager_please_set_keywords"),3000);return d(this).prop("checked",false)}XF.ajax("POST",XF.canonicalizeUrl("index.php?ads-manager/ajax/verify-exclusive-keywords"),{ad_id:f.options.adId,keywords:i},function(j){if(j.message){XF.flashMessage(j.message,3000)}})});d('input[name="discount"]').on("change",function(){var i=d(this).data("purchase");d('input[name="purchase"]').val(i).trigger("change")});d('input[name="purchase"]').on("change keyup",function(){f.calculateTotalCost()});d(".inputNumber").on("click",function(){d('input[name="purchase"]').trigger("change")});this.$target.on("click keydown",function(){f.calculateTotalCost()});var h=this.$target.find('input[name="terms_agreement"]');var g=this.$target.find('button[name="save"]');if(h.length&&!h.is(":checked")){g.prop("disabled",true).css("opacity",0.5)}h.on("change",function(){g.prop("disabled",d(this).is(":checked")?false:true).css("opacity",d(this).is(":checked")?1:0.5)});this.calculateTotalCost()},calculateTotalCost:function(){var g=this.$target.find('input[name="purchase"]');var x=this.options.minPurchase;if(g.length){x=g.val()}var h=2;switch(this.options.currency){case"TWD":case"HUF":case"JPY":case"IRR":case"KMF":case"ISK":case"KRW":case"GNF":case"DJF":case"CLP":case"BYR":case"BIF":case"PYG":case"RWF":case"UGX":case"VND":case"XAF":case"XOF":case"ZMK":h=0;break}var f=this.options.costAmount;var t=0;var o=0;var z=this.options.adType;switch(z){case"code":case"banner":case"text":case"link":case"popup":t+=f;break;case"keyword":var u=this.$target.find("td[data-cost-premium], span[data-cost-premium]");var l=this.$target.find('textarea[name="content_1"]').val();var q=this.$target.find('input[name="exclusive_use"]');var j=this.options.costPer=="cpc"||this.options.costPer=="cpm";if(l){var n=l.toLowerCase().trim().split("\n");var m=n.length;if(u.length){var k=0;u.each(function(){if(d.inArray(d(this).text(),n)!==-1){var B=d(this).data("cost-premium");t+=Number(B.toFixed(h));k++}});if(m!=k){t+=j?f:(f*(m-k))}}else{var v=j?f:(f*m);t+=Number(v.toFixed(h))}if(q.length&&q.is(":checked")){var v=parseFloat(q.data("cost-exclusive")*m);o+=Number(v.toFixed(h))}}break;case"thread":case"sticky":case"resource":if(z=="thread"){var p=this.$target.find('select[name="content_1"]').val();var y=this.$target.find('input[name="sticky"]');if(y.length&&y.is(":checked")){var v=parseFloat(y.data("cost-sticky"));o+=Number(v.toFixed(h))}}else{var p=this.$target.find('select[name="item_id"]').val()}if(p){var w=this.$target.find('select[name="forum"], select[name="content_1"]');var v=w.find("option:selected").data("cost-custom");if(v){t+=Number(v.toFixed(h))}else{t+=f}}else{if(this.options.costCustom){t+=this.options.costCustom}}break}if(t){var A=Number(t*(this.options.costPer=="cpm"?(x/1000):x)+o);var r=this.$target.find('input[name="discount"]');var i=0;if(r.length){r.each(function(){if(x>=d(this).data("purchase")){i=d(this).data("discount")}});if(i){A-=Number((A*i)/100)}}var s=this.$target.find('input[name="promo_code"]');if(s.length){discountType=s.data("discount-type");i=s.data("discount-value");switch(discountType){case"percent":A-=Number((A*i)/100);break;case"amount":A-=i;break}}A=Math.max(0,A.toFixed(h));d("#samTotalCost").html(A+" "+this.options.costCurrency);d("#samTotalCost").attr("data-cost-amount",A)}}});XF.SAMPromoCode=XF.Element.newHandler({options:{},init:function(){this.$target.find("button").on("click",function(){var f=d('input[name="promo_code"]');var h=f.val().trim();var g=d("#samTotalCost").attr("data-cost-amount");if(!h){return f.focus()}if(f.data("applied")==h){return}XF.ajax("POST",XF.canonicalizeUrl("index.php?ads-manager/ajax/verify-promo-code"),{package_id:d('input[name="package_id"]').val(),promo_code:h,cost_amount:g},function(i){if(i.message){XF.flashMessage(i.message,3000)}if(i.applied){f.data("applied",h);f.data("discount-value",i.discountValue);f.data("discount-type",i.discountType);f.parents("form").trigger("click")}})})}});XF.SAMSelectForum=XF.Element.newHandler({options:{},init:function(){var f=this;this.$target.on("change",function(){var h=d(this).val();var g=d(".samPrefixId");var i=d('select[name="prefix_id"]');var j=d('input[name="sticky"]');if(h){XF.ajax("POST",XF.canonicalizeUrl("index.php?ads-manager/ajax/get-forum-thread-options"),{package_id:d('input[name="package_id"]').val(),forum_id:h},function(n){if(n.message){return XF.flashMessage(n.message,3000)}var m="";for(var o in n.prefixList){m+='<option value="'+o+'">'+n.prefixList[o]+"</option>"}if(m){g.css("display","table")}else{g.css("display","none")}i.html(m);b(n,f.$target);if(n.customFields){d(".samCustomFields").html(n.customFields).show()}else{d(".samCustomFields").hide()}var k=d(".js-attachmentUpload");if(k.length){var l=k.attr("href");k.attr("href",l.replace(/\[node_id\]=[0-9]+/,"[node_id]="+h))}});toggleStickyCheckbox=false}else{g.css("display","none");i.html("");toggleStickyCheckbox=true}if(j.length){j.prop("disabled",toggleStickyCheckbox)}})}});XF.SAMSelectItem=XF.Element.newHandler({options:{fetch:""},init:function(){var f=this;this.$target.on("change",function(){var h=d('input[name="package_id"]');var g=d('select[name="item_id"]');var i=d(this).val();if(i){XF.ajax("POST",XF.canonicalizeUrl("index.php?ads-manager/ajax/get-user-"+f.options.fetch),{package_id:h.val(),item_id:i},function(j){if(j.message){XF.flashMessage(j.message,3000)}if(j.options){g.html(j.options).prop("disabled",false)}else{g.html("").prop("disabled",true)}b(j,g)})}})}});XF.SAMCanStickThread=XF.Element.newHandler({options:{},init:function(){var g=this.$target;var f=d('select[name="content_1"]').val();if(!(g.is(":checked")||f)){g.prop("disabled",true)}g.on("change",function(){if(f){XF.ajax("POST",XF.canonicalizeUrl("index.php?ads-manager/ajax/verify-empty-promo-thread-sticky-slots"),{forum_id:f},function(h){if(h.message){XF.flashMessage(h.message,3000);g.prop("checked",false)}})}})}});XF.SAMDeleteFile=XF.Click.newHandler({eventNameSpace:"SAMDeleteFile",options:{file:"",postUrl:""},init:function(){},click:function(){var f=this.$target.parents("li.samFile");XF.ajax("GET",XF.canonicalizeUrl(this.options.postUrl),{file:this.options.file},function(g){if(g.deleted){f.fadeOut()}})}});XF.Element.register("siropu-ads-manager-create","XF.SAMCreate");XF.Element.register("siropu-ads-manager-apply-promo-code","XF.SAMPromoCode");XF.Element.register("siropu-ads-manager-select-forum","XF.SAMSelectForum");XF.Element.register("siropu-ads-manager-select-item","XF.SAMSelectItem");XF.Element.register("siropu-ads-manager-can-stick-thread","XF.SAMCanStickThread");XF.Click.register("siropu-ads-manager-delete-file","XF.SAMDeleteFile")}(jQuery,window,document);