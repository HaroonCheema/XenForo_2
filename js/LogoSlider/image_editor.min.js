window.XFMG=window.XFMG||{};
((d,e)=>{XFMG.ImageEditor=XF.Element.newHandler({options:{image:".js-mediaImg",cropData:".js-cropData",move:".js-ctrlDragMove",crop:".js-ctrlDragCrop",zoomIn:".js-ctrlZoomIn",zoomOut:".js-ctrlZoomOut",rotateLeft:".js-ctrlRotateLeft",rotateRight:".js-ctrlRotateRight",flipH:".js-ctrlFlipH",flipV:".js-ctrlFlipV",clear:".js-ctrlClear"},image:null,cropper:null,init(){const a=this.target,b=a.querySelector(this.options.image),c=a.querySelector(this.options.cropData);b&&b.matches("img")||console.error("Image editor must contain an img element");
this.image=b;this.cropper=new Cropper(b,{viewMode:2,autoCrop:!1,ready:()=>{XF.on(a.querySelector(`${this.options.move}`),"click",XF.proxy(this,"dragMode"));XF.on(a.querySelector(`${this.options.crop}`),"click",XF.proxy(this,"dragMode"));XF.on(a.querySelector(`${this.options.zoomIn}`),"click",XF.proxy(this,"zoom"));XF.on(a.querySelector(`${this.options.zoomOut}`),"click",XF.proxy(this,"zoom"));XF.on(a.querySelector(`${this.options.rotateLeft}`),"click",XF.proxy(this,"rotate"));XF.on(a.querySelector(`${this.options.rotateRight}`),
"click",XF.proxy(this,"rotate"));XF.on(a.querySelector(`${this.options.flipH}`),"click",XF.proxy(this,"flip"));XF.on(a.querySelector(`${this.options.flipV}`),"click",XF.proxy(this,"flip"));XF.on(a.querySelector(this.options.clear),"click",XF.proxy(this,"clear"))},crop:f=>{c.value=JSON.stringify(this.cropper.getData(!0))}})},dragMode(a){a=a.currentTarget;a.matches(this.options.move)?this.cropper.setDragMode("move"):a.matches(this.options.crop)&&this.cropper.setDragMode("crop")},zoom(a){a=a.currentTarget;
a.matches(this.options.zoomIn)?this.cropper.zoom(.1):a.matches(this.options.zoomOut)&&this.cropper.zoom(-.1)},rotate:function(a){a=a.currentTarget;a.matches(this.options.rotateLeft)?this.cropper.rotate(-10):a.matches(this.options.rotateRight)&&this.cropper.rotate(10)},flip(a){a=a.currentTarget;let b=a.dataset.scale;a.matches(this.options.flipH)?this.cropper.scaleX(b):a.matches(this.options.flipV)&&this.cropper.scaleY(b);a.dataset.scale=-1*b},clear:function(a){this.cropper.clear()}});XF.Element.register("image-editor",
"XFMG.ImageEditor")})(window,document);
