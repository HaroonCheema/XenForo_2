window.XFMG=window.XFMG||{};
((e,f)=>{XFMG.attachmentManager=null;XFMG.MediaManager=XF.Element.newHandler({options:{mediaActionUrl:null,onInsertHandler:".js-mediaOnInsertHandler"},init(){XFMG.attachmentManager=XF.Element.applyHandler(this.target,"attachment-manager",this.options);this.options=XF.extendObject({},this.options,XFMG.attachmentManager.options);XF.onDelegated(XFMG.attachmentManager.filesContainer,"click",this.options.actionButton,XF.proxy(this,"actionButtonClick"))},actionButtonClick(a){a.preventDefault();var b=a.target;
b.matches("button")||(b=b.closest("button"));a=b.getAttribute("data-action");b=b.closest(this.options.fileRow);switch(a){case "delete":this.deleteMediaItem(b)}},deleteMediaItem(a){const b=a.dataset.tempMediaId,c=this.options.mediaActionUrl;b&&(c?XF.ajax("post",c,{delete:b},d=>{d.delete&&XFMG.attachmentManager.removeFileRow(a)},{skipDefaultSuccess:!0}):XFMG.attachmentManager.removeFileRow(a))}});XFMG.LinkChecker=XF.Element.newHandler({options:{pasteInput:".js-pasteInput",pasteError:".js-pasteError"},
pasteInput:null,pasteError:null,attachmentManager:null,init(){const a=this.target;this.attachmentManager=XFMG.attachmentManager;(this.pasteInput=a.querySelector(this.options.pasteInput))?(this.pasteError=a.querySelector(this.options.pasteError),XF.on(this.pasteInput,"paste",XF.proxy(this,"paste")),XF.on(a,"ajax-submit:before",XF.proxy(this,"beforeSubmit")),XF.on(a,"ajax-submit:response",XF.proxy(this,"complete")),XF.on(a,"ajax-submit:error",XF.proxy(this,"error"))):console.error("No input to monitor for pasted text.")},
paste(a){const b=this.pasteError;setTimeout(()=>{XF.trigger(this.target,"submit");XF.Transition.removeClassTransitioned(b,"is-active")},100)},beforeSubmit(a){null==this.attachmentManager&&(a.preventSubmit=!0,console.error("No attachment manager available on %o.",this.target))},complete(a){const {data:b}=a;b.errors||b.exception||(a.preventDefault(),this.pasteInput.value="",XF.hideOverlays(),this.attachmentManager.insertUploadedRow(b.attachment))},error(a){const {data:b}=a,c=this.pasteError;c&&(a.preventDefault(),
c.querySelector("div").textContent=b.errors[0],XF.Transition.addClassTransitioned(c,"is-active"),this.pasteInput.value="")}});XF.Element.register("media-manager","XFMG.MediaManager");XF.Element.register("link-checker","XFMG.LinkChecker")})(window,document);
