{"version":3,"sources":["../src/overlay-fix.js"],"names":["AL","window","XF","$","document","on","evt","data","$target","target","handler","Element","getHandler","$overlay","closest","doRedirect","redirect","options","attr","status","forceFlashMessage","message","preventDefault","flashMessage","hasOwnProperty","OverlayClick","extend","__backup","init","addonslabOverlayClickInit","messageTimeout","parseInt","show","overlay","loading","followRedirects","addonslabOverlayClickShow","console","log","ajax","t","cache","beforeShow","proxy","loadOverlay","loadUrl","overlayConfig","always","setTimeout","jQuery"],"mappings":"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","sourcesContent":["/**\n * Fixes the issue with XF toggle control triggering the submit event twice, once on the label once on the input\n */\n// @ts-check\n\nconst AL = window.AL || {};\n/**\n * For the custom delay to work on any link, clicking which we immediately get a redirect response:\n * 1. message-with-delay key in the JSON response (used to stop the default message)\n * 2. data-force-flash-message=\"on\" and data-follow-redirects=\"on\" on the link\n * 3. Additional attribute on the link to define the length of message - data-message-timeout=\"3000\"\n *\n * For the custom delay to work on a form, simply add data-redirect-timeout=\"3000\"\n * to other data attributes of \"ajax-submit\" form\n */\n!function (XF, $, window, document, _undefined) {\n    $(document).on('ajax-submit:response', function (evt, data) {\n        const $target = $(evt.target);\n        const handler = XF.Element.getHandler($target, 'ajax-submit');\n        const $overlay = $target.closest('.overlay');\n        const doRedirect = data.redirect && handler.options.redirect;\n        if (\n            handler\n            && $target.attr('data-redirect-timeout')\n            && data.status === 'ok'\n            && doRedirect\n            && handler.options.forceFlashMessage\n            && data.message\n        ) {\n            evt.preventDefault();\n            XF.flashMessage(data.message, $target.attr('data-redirect-timeout'), function () {\n                XF.redirect(data.redirect);\n            });\n        }\n    });\n\n    $(document).on('ajax:before-success', function (evt, data) {\n        if (\n            data && data.status === 'ok' && data.message\n            && data.hasOwnProperty('message-with-delay')\n        ) {\n            // Store the original message\n            data['message-with-timeout'] = data.message;\n            // remove it to prevent the default message from appearing\n            data.message = '';\n        }\n    });\n    XF.OverlayClick = XF.extend(XF.OverlayClick, {\n        __backup: {\n            'show': 'addonslabOverlayClickShow',\n            'init': 'addonslabOverlayClickInit',\n        },\n        init: function () {\n            this.addonslabOverlayClickInit();\n            var messageTimeout = this.$target.data('messageTimeout');\n            this.options.messageTimeout = messageTimeout ? parseInt(messageTimeout) : null;\n        },\n        show: function () {\n            if (this.options.messageTimeout === null || this.overlay || this.loading || !this.options.followRedirects) {\n                // In any of those cases our fix would not apply anyway\n                this.addonslabOverlayClickShow();\n                return;\n            }\n\n            var messageTimeout = this.options.messageTimeout;\n\n            console.log('Delaying redirect for ' + messageTimeout + 'ms');\n\n            // This code is a copy has we had to change the messageTimeout to a configurable number\n            this.loading = true;\n\n            var t = this,\n                options = {\n                    cache: this.options.cache,\n                    beforeShow: function (overlay) {\n                        t.overlay = overlay;\n                    },\n                    init: XF.proxy(this, 'setupOverlay')\n                },\n                ajax;\n\n            if (this.options.followRedirects) {\n                options['onRedirect'] = function (data, overlayAjaxHandler) {\n                    if (t.options.forceFlashMessage) {\n                        XF.flashMessage(data.message || data['message-with-timeout'], messageTimeout, function () {\n                            XF.redirect(data.redirect);\n                        });\n                    } else {\n                        XF.redirect(data.redirect);\n                    }\n                };\n            }\n\n            ajax = XF.loadOverlay(this.loadUrl, options, this.options.overlayConfig);\n\n            if (ajax) {\n                ajax.always(function () {\n                    setTimeout(function () {\n                        t.loading = false;\n                    }, 300);\n                });\n            } else {\n                this.loading = false;\n            }\n\n        }\n    });\n    return true;\n// @ts-ignore\n}(window.XF, window.jQuery, window, document);\n\n"],"file":"overlay-fix.min.js"}