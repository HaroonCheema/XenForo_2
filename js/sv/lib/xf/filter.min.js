var SV=window.SV||{};SV.StandardLib=SV.StandardLib||{};SV.$=SV.$||window.jQuery||null;SV.extendObject=SV.extendObject||XF.extendObject||jQuery.extend;
((k,m)=>{var l=SV.$,f="function"!==typeof XF.on;SV.StandardLib.DynamicFilter=XF.extend(XF.Filter,{__backup:{init:"svLib__init",_filterAjax:"svLib__filterAjax",filter:"svLib__filter",update:"svLib__update",_filterAjaxResponse:"svLib__filterAjaxResponse",_appendRows:"svLib__appendRows"},options:SV.extendObject({},XF.Filter.prototype.options,{svLoadInOverlay:!0,pageNavWrapper:".block-outer--page-nav-wrapper",searchTarget:".userList",searchRow:".userList-row",searchRowGroup:null,searchLimit:".username",
noResultsFormat:'<div class="blockMessage js-filterNoResults">%s</div>',globalFind:!0,perPageDropdown:'select[name="per_page"]',perPageCookiePrefix:null}),resetPage:!0,skipUpdate:!1,svPerPageDropdown:null,finalUrl:null,inOverlay:!1,svChangeTimer:null,svLastPageSelected:null,_getStoredValue:function(){return null},_updateStoredValue:function(a,b){},init:function(){var a=this.target||this.$target.get(0);this.inOverlay=null!==a.closest(".overlay-container");if(this.options.ajax){var b=null,c=this.getPageNavWrappers();
null!==c&&(c=c[0].querySelector(".pageNav-page--current > a"))&&(b=this.getPageFromAhref(c));this.svLastPageSelected="number"===typeof b?b:1;this.svPerPageDropdown=a.querySelector(this.options.perPageDropdown);if(null!==this.svPerPageDropdown)if(f)l(this.svPerPageDropdown).on("change",this.svPerPageChange.bind(this));else XF.on(this.svPerPageDropdown,"change",this.svPerPageChange.bind(this));this.skipUpdate=!0;try{this.svLib__init()}finally{this.skipUpdate=!1}this.shimDynamicPageNav()}else console.error("No filter AJAX URL input was provided.")},
svPerPageChange:function(){this.svChangeTimer&&clearTimeout(this.svChangeTimer);this.svChangeTimer=setTimeout(this.svPerPageOnTimer.bind(this),200)},svPerPageOnTimer:function(){var a=this.svPerPageDropdown.value;a&&(null!==this.options.perPageCookiePrefix&&XF.Cookie.set(this.options.perPageCookiePrefix+"per_page",a,new Date((new Date).setFullYear((new Date).getFullYear()+1))),this.update())},_filterAjax:function(a,b){var c=this.getCurrentPage()||1;a={_xfFilter:{text:a,prefix:b?1:0}};1!=c&&(a.page=
c);c=this.options.ajax;this.svPerPageDropdown&&(c=new Url(this.options.ajax),c.query.per_page=this.svPerPageDropdown.value,c=c.toString());this.xhrFilter=a._xfFilter;XF.ajax("GET",c,a,this._filterAjaxResponse.bind(this))},_appendRows:function(a){if(f)this.svLib__appendRows(a);else{var b=this.search.querySelectorAll(this.options.searchRow);b=b[b.length-1];var c=null,e=this.options.searchRowGroup;b&&(e&&(c=b.closest(e)),!c&&b.matches("tr")&&(c=b.closest("tbody")),c||=b);if(c)Array.from(a).reverse().forEach(d=>
{c.insertAdjacentElement("afterend",d)});else{const d=this.search;a.forEach(function(h){d.append(h)})}}},_filterAjaxResponse:function(a){var b=this.xhrFilter,c=this._getSearchRows();f&&(c=c.toArray());b.text||(c.forEach(e=>e.remove()),c=[]);a.html.content="<div>"+a.html.content.trim()+"</div>";XF.setupHtmlInsert(a.html,e=>{f?(this.xhr=null,e=e.get(0)):this.abortController=null;this._clearAjaxRows();var d=e.querySelectorAll(this.options.searchRow);c.forEach(g=>g.classList.add("is-hidden"));this._applyRowGroupLimit();
this._toggleNoResults(0===d.length);d.length?f?(d=l(d),this._appendRows(d),XF.activate(d),this.$ajaxRows=d,this._applyFilter(d,b.text,b.prefix)):(this._appendRows(d),XF.activateAll(d),this.ajaxRows=d,this._applyFilter(d,b.text,b.prefix)):XF.layoutChange();this.xhrFilter=null;d=this.getPageNavWrappers();if(null!==d){var h=e.querySelector(this.options.pageNavWrapper);null===h?d.forEach(function(g){g.innerHTML=""}):(d.forEach(function(g){g.innerHTML=h.innerHTML}),this.shimDynamicPageNav(),this.inOverlay||
(e=e.querySelector('input[type="hidden"][name="final_url"]'),null===e?console.error("No final URL input was provided."):(e=e.value)?"pushState"in k.history?k.history.pushState({state:1,rand:Math.random()},"",e):k.location=e:console.error("No final URL available.")))}})},update:function(){this.skipUpdate||this.svLib__update()},filter:function(a,b){this.resetPage&&(this.svLastPageSelected=1);this._toggleFilterHide(0<a.length);this.options.ajax?this._filterAjax(a,b):(a=this._applyFilter(this._getSearchRows(),
a,b),this._toggleNoResults(0===a))},shimDynamicPageNav:function(){var a=this.getPageNavWrappers();if(null!==a)if(f)a=l(a),a.find(".pageNav a[href]").on("click",this.ajaxLoadNewPage.bind(this)),XF.activate(a);else for(const b of a){for(const c of b.querySelectorAll(".pageNav a[href]"))XF.on(c,"click",this.ajaxLoadNewPage.bind(this));XF.activate(b)}},getPageFromAhref:function(a){a=a.getAttribute("href");if(!a)return 1;a=new Url(a);return"page"in a.query?parseInt(a.query.page)||1:1},ajaxLoadNewPage:function(a){a.preventDefault();
a=this.getPageFromAhref(a.target);if(a!=this.svLastPageSelected){this.svLastPageSelected=a;this.resetPage=!1;try{this.update()}finally{this.resetPage=!0}}},getPageNavWrappers:function(a){a="undefined"===typeof a?!0:a;if(!this.options.pageNavWrapper)return a&&console.error("No pagination wrapper query expression defined"),null;var b=(this.target||this.$target.get(0)).querySelectorAll(this.options.pageNavWrapper);return null===b||0===b.length?(a&&console.error("No old pagination wrapper available"),
null):b},getCurrentPage:function(){if(!this.options.pageNavWrapper||null===this.getPageNavWrappers(!1))return null;var a=parseInt(this.svLastPageSelected)||null;return a?a:null}});XF.Element.register("sv-dynamic-filter","SV.StandardLib.DynamicFilter")})(window,document);
