var SV=window.SV||{};SV.StandardLib=SV.StandardLib||{};SV.$=SV.$||window.jQuery||null;SV.extendObject=SV.extendObject||XF.extendObject||jQuery.extend;
(function(){function m(a){return a&&a.charAt(0).toUpperCase()+a.slice(1)}let k=SV.$,n=Choices.prototype._createElements,p=Choices.prototype._createStructure;Choices.prototype._createElements=function(){n.call(this);const a=this.passedElement.element;this.isDynamicRendered=!a.dataset.rendered;if(!this.isDynamicRendered){var b=function(d,e,f){null===e?console.warn("Expected pre-rendered element for "+f+" does not exist",a):d.element=e},c=a.closest(".choices.svChoices--inputGroup");b(this.containerOuter,
c,".choices.svChoices--inputGroup");c&&(b(this.containerInner,c.querySelector(".choices__inner"),".choices__inner"),b(this.input,c.querySelector('input[type="search"]'),'input[type="search"]'),b(this.itemList,c.querySelector(".choices__list"),".choices__list"))}};Choices.prototype._createStructure=function(){this.isDynamicRendered?p.call(this):(this.containerOuter.element.appendChild(this.dropdown.element),this._isTextElement||this.dropdown.element.appendChild(this.choiceList.element),this._isSelectOneElement&&
this.config.searchEnabled&&this.dropdown.element.insertBefore(this.input.element,this.dropdown.element.firstChild),this._isSelectOneElement||this.input.setWidth(),this._highlightPosition=0,this._isSearching=!1)};SV.StandardLib.Choices=XF.Element.newHandler({options:{resetOnSubmit:!1,placeholder:null,maxItemCount:-1,removeItemButton:!0,removeItemButtonAlignLeft:!0,shouldSort:!1,shouldSortItems:!1,editItems:!1,resetScrollPosition:!1,renderSelectedChoices:"always",renderChoiceLimit:-1,searchResultLimit:-1,
appendGroupInSearch:!0},initialValue:null,form:null,choices:null,init:function(){var a=this.target||this.$target.get(0);this.form=a.closest("form");this.initialValue=a.value;this.choices=new Choices(a,this.getConfig());this.initEvents();"boolean"!==typeof this.choices.isDynamicRendered||this.choices.isDynamicRendered||!this.choices._canSearch||!(a=this.choices.input.value)&&this.choices.input.element!==document.activeElement||(this.choices.showDropdown(!1),this.choices.input.isFocussed=!0,a&&this.choices._handleSearch(a))},
getConfig:function(){let a=this.target||this.$target.get(0),b=this.options.placeholder||a.getAttribute("placeholder"),c=!!b,d=SV.extendObject({},this.options,{allowHTML:!1,singleModeForMultiSelect:1===this.options.maxItemCount,placeholder:c,placeholderValue:c?b:null,classNames:this.getClassNames(),fuseOptions:this.getFuseOptions()},this.getPhrases());delete d.resetOnSubmit;d.singleModeForMultiSelect||a.getAttribute("multiple")||-1!==d.maxItemCount||(d.singleModeForMultiSelect=!0,d.maxItemCount=1,
this.options.maxItemCount=1);const e=(this.target||this.$target.get(0)).dataset,f=Choices.defaults.allOptions;Object.keys(f).forEach(h=>{if(!(h in d)&&h in e){var g=e[h],l=!0;switch(typeof f[h]){case "string":try{g=JSON.parse(g)}catch(q){}break;case "number":g=Number(g);isNaN(g)&&(l=!1);break;case "boolean":g=XF.toBoolean(g);break;default:return}l&&(d[h]=g)}});return d},getFuseOptions:function(){return{}},getPhrase:function(a,b){(a=XF.phrases[a])&&b&&(a=XF.stringTranslate(a,b));return a||""},getPhrases:function(){return{loadingText:this.getPhrase("svChoices_loadingText"),
noResultsText:this.getPhrase("svChoices_noResultsText"),noChoicesText:this.getPhrase("svChoices_noChoicesText"),itemSelectText:this.getPhrase("svChoices_itemSelectText"),uniqueItemText:this.getPhrase("svChoices_uniqueItemText"),customAddItemText:this.getPhrase("svChoices_customAddItemText"),addItemText:function(a){return this.getPhrase("svChoices_addItemText",{"{value}":a},"")}.bind(this),removeItemIconText:"",removeItemLabelText:function(a){return this.getPhrase("svChoices_removeItemLabel",{"{value}":a},
"")}.bind(this),maxItemText:function(a){return this.getPhrase("svChoices_maxItemText",{"{maxItemCount}":a},"")}.bind(this)}},getClassNames:function(){const a={containerOuter:["choices","inputGroup","svChoices--inputGroup"],containerInner:["choices__inner","input"]};XF.phrases.svChoices_itemSelectText&&a.containerOuter.push("svChoices--select-prompt");const b=(this.target||this.$target.get(0)).dataset,c=Choices.defaults.allOptions.classNames;Object.keys(c).forEach(d=>{var e="class"+m(d);e=b[e];"undefined"!==
typeof e&&(e=(""+e).split(" "),0!==e.length&&(d in a||(a[d]=[]),c[d].forEach(f=>a[d].push(f)),e.forEach(f=>a[d].push(f))))});return a},initEvents:function(){if(this.choices){var a=this.form,b=this.choices.passedElement.element;if("function"!==typeof XF.on){if(this.options.resetOnSubmit&&(a=k(a),a.length))a.on("ajax-submit:response",this.afterFormSubmit.bind(this));b=k(b);b.on("addItem",this.onAddItem.bind(this));b.on("removeItem",this.onRemoveItem.bind(this));b.on("choice",this.onChoice.bind(this));
b.on("showDropdown",this.onShowDropdown.bind(this));b.on("hideDropdown",this.onHideDropdown.bind(this));b.on("control:enabled",this.onControlEnabled.bind(this));b.on("control:disabled",this.onControlDisabled.bind(this));b.on("refreshChoices",this.onRefreshChoices.bind(this))}else{if(this.options.resetOnSubmit&&a instanceof HTMLFormElement)XF.on(a,"ajax-submit:response",this.afterFormSubmit.bind(this));XF.on(b,"addItem",this.onAddItem.bind(this));XF.on(b,"removeItem",this.onRemoveItem.bind(this));
XF.on(b,"choice",this.onChoice.bind(this));XF.on(b,"showDropdown",this.onShowDropdown.bind(this));XF.on(b,"hideDropdown",this.onHideDropdown.bind(this));XF.on(b,"control:enabled",this.onControlEnabled.bind(this));XF.on(b,"control:disabled",this.onControlDisabled.bind(this));XF.on(b,"refreshChoices",this.onRefreshChoices.bind(this))}}else console.error("Choices not setup.")},onAddItem:function(a){if(null===this.choices)console.error("Choices not setup.");else{a=a.detail;var b=a.customProperties;"undefined"!==
typeof b&&(b.clears?this.choices.removeActiveItems(a.id):this.choices._store.items.forEach(c=>{let d=c.customProperties;"object"===typeof d&&d.clears&&this.choices.removeActiveItemsByValue(c.value)}));this.triggerFormFillIfNeeded()}},onRemoveItem:function(a){this.triggerFormFillIfNeeded()},onChoice:function(a){},onShowDropdown:function(a){},onHideDropdown:function(a){},onControlEnabled:function(a){this.choices?this.choices.enable():console.error("Choices not setup.")},onControlDisabled:function(a){this.choices?
this.choices.disable():console.error("Choices not setup.")},onRefreshChoices:function(a,b,c){this.choices?(b="undefined"===typeof a.html?b:a.html,a="undefined"===typeof a.listRaw?c:a.listRaw,c=null,b instanceof HTMLDivElement?c=b.querySelector("select"):b instanceof HTMLSelectElement?c=b:a instanceof Object&&this.choices.clearStore().setChoices(a),null!==c&&(this.choices.passedElement.element.innerHTML=c.innerHTML,this.choices.refresh())):console.error("Choices not setup.")},afterFormSubmit:function(a,
b){b=b||a.data;b.errors||"ok"!==b.status||(this.choices?this.choices._onFormReset():console.error("No choices setup."))},onFormReset:function(){this.choices?this.choices._onFormReset():console.error("No choices setup.")},triggerFormFillIfNeeded(){const a=XF.Element.getHandler(this.target?this.form:k(this.form),"form-fill");null!==a&&a.change()}});SV.StandardLib.ChoicesLoader=XF.Element.newHandler({options:{listenTo:"",initUpdate:!0,href:""},init(){if(!(this.target||this.$target.get(0)).matches("select"))console.error("Must trigger on select");
else if(this.options.href){const a=this.options.listenTo?XF.findRelativeIf(this.options.listenTo,this.target||this.$target):null;if(a){if("function"!==typeof XF.on)a.on("change",XF.proxy(this,"loadChoices"));else XF.on(a,"change",this.loadChoices.bind(this));this.options.initUpdate&&("function"===typeof XF.trigger?XF.trigger(a,"change"):a.trigger("change"))}else console.error("Cannot load choices dynamically as no element set to listen to for changes")}},loadChoices(a){XF.ajax("POST",this.options.href,
{val:a.target.value},this.loadSuccess.bind(this))},loadSuccess(a){if(a.html){const b=this.target||this.$target.get(0);XF.setupHtmlInsert(a.html,c=>{"function"!==typeof XF.trigger?k(b).trigger("refreshChoices",[c.get(0)]):XF.trigger(b,XF.customEvent("refreshChoices",{html:c}))})}}});XF.Element.register("sv-choices","SV.StandardLib.Choices");XF.Element.register("sv-choices-loader","SV.StandardLib.ChoicesLoader")})();
