(function($){$(document).on("editor:config",function(event,config,xfEditor){var initialized=false,loaded=false,$menu,$menuScroll,scrollTop=0,flashTimeout,logTimeout,timer;function showMenu(){selectionSave();XF.EditorHelpers.blur(xfEditor.ed);var $btn=$(xfEditor.ed.$tb.find('.fr-command[data-cmd="pfEsAddSymbol"]')).first();if(!initialized){initialized=true;var menuHtml=$.trim($(".js-xfEditorMenu").first().html());$menu=$($.parseHTML(Mustache.render($(".js-editorPfEsSymbolsMenu").first().html())));$menu.insertAfter($btn);$btn.data("xf-click","menu");var handler=XF.Event.getElementHandler($btn,"menu","click");$menu.on("menu:complete",function(){$menuScroll=$menu.find(".menu-scroller");if(!loaded){loaded=true;$menuScroll.find(".js-psEsSymbol").on("click",insertSpecialChar);xfEditor.ed.events.on("commands.mousedown",function($el){if($el.data("cmd")!=="pfEsAddSymbol"){handler.close()}});$menu.on("menu:closed",function(){scrollTop=$menuScroll.scrollTop()})}$menuScroll.scrollTop(scrollTop)});$menu.on("menu:closed",function(){setTimeout(function(){xfEditor.ed.markers.remove()},50)})}var clickHandlers=$btn.data("xfClickHandlers");if(clickHandlers&&clickHandlers.menu){clickHandlers.menu.toggle()}}function insertSpecialChar(e){var $target=$(e.currentTarget),html=$target.html().trim();XF.EditorHelpers.focus(xfEditor.ed);xfEditor.ed.html.insert(html);selectionSave();XF.EditorHelpers.blur(xfEditor.ed)}function selectionSave(){xfEditor.ed.selection.save()}function selectionRestore(){xfEditor.ed.selection.restore()}$.FE.DefineIcon("pfEsAddSymbol",{NAME:"university"});$.FE.RegisterCommand("pfEsAddSymbol",{title:"Insert Symbol",icon:"pfEsAddSymbol",undo:false,focus:false,refreshOnCallback:false,callback:function(){showMenu()}})})})(jQuery);